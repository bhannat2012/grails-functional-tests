<project>
    <macrodef name="grails">
        <attribute name="command" description="the command line to execute"/>
        <attribute name="environment" default="" description="The environment to use for the command."/>
        <attribute name="projectName" default=""/>
        <attribute name="resultID" default="0"/>
    	<attribute name="dir" default="${checkoutDir}/@{projectName}"/>
    	<attribute name="failonerror" default="false"/>
        <attribute name="serverPort" default="8083" />
        <sequential>
            <echo message="Executing: grails @{command}"/>
            <exec executable="${grailsCmd.absolute}" dir="@{dir}" resultproperty="testResult_@{resultID}" failonerror="@{failonerror}">
                <arg value="-Dserver.port=@{serverPort}" />
                <arg value="-Djava.util.logging.manager=java.util.logging.LogManager"/>
                <arg value="-Dgrails.work.dir=work"/>
                <arg value="@{environment}" />
                <arg value="@{command}"/>
                <env key="GRAILS_HOME" path="${grails.home}"/>
            </exec>
        </sequential>
    </macrodef>


</project>
